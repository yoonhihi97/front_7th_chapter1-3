# 기능 명세: 캘린더 날짜 클릭 시 폼 날짜 자동 입력

## 질문 및 답변

### Q1: 클릭 가능한 영역
**질문**: TableCell의 어느 영역을 클릭했을 때 날짜가 입력되어야 하나요?
- 옵션 A: 빈 공간만 (이벤트 박스 제외)
- 옵션 B: TableCell 전체 영역 (이벤트 박스 클릭 시에도)
- 옵션 C: 날짜 숫자 부분만

**답변**: 옵션 B - TableCell 전체 영역 (단, 이벤트 박스는 stopPropagation 필요)

### Q2: 편집 모드와의 상호작용
**질문**: 사용자가 일정을 편집 중일 때 다른 날짜 셀을 클릭하면 어떻게 동작해야 하나요?
- 옵션 A: 편집 모드 유지하고 날짜만 변경
- 옵션 B: 편집 모드 취소하고 새 일정 생성 모드로 전환
- 옵션 C: 경고 메시지를 표시하고 아무 동작도 하지 않음

**답변**: 옵션 A - 편집 모드 유지하고 날짜만 변경

### Q3: 이벤트 박스 클릭 동작
**질문**: 이벤트 박스 영역을 클릭했을 때 어떻게 동작해야 하나요?
- 옵션 A: 해당 이벤트를 편집 모드로 전환
- 옵션 B: 날짜 클릭과 동일하게 동작 (폼 날짜 변경)
- 옵션 C: 아무 동작도 하지 않음 (드래그만 지원)

**답변**: 옵션 C - 아무 동작도 하지 않음 (stopPropagation 필요)

### Q4: 시간 유효성 검증 오류 처리
**질문**: 폼에 시간 오류(예: 종료 시간 < 시작 시간)가 있는 상태에서 날짜를 클릭하면 어떻게 동작해야 하나요?
- 옵션 A: 오류 상태 유지하고 날짜만 변경
- 옵션 B: 오류를 초기화하고 날짜 변경
- 옵션 C: 날짜 변경을 차단하고 오류 해결 요구

**답변**: 옵션 A - 오류 상태 유지하고 날짜만 변경

### Q5: 반복 일정 설정 보존
**질문**: 반복 일정 설정(repeatType, interval, endDate)이 있는 상태에서 날짜를 클릭하면 어떻게 처리해야 하나요?
- 옵션 A: 반복 설정 완전히 유지 (새 시작 날짜 기준으로 반복)
- 옵션 B: 반복 설정 초기화 (단일 일정으로 전환)
- 옵션 C: 반복 타입만 유지하고 interval/endDate는 초기화

**답변**: 옵션 A - 반복 설정 완전히 유지

### Q6: 주간 뷰에서 이전/다음 달 날짜 클릭
**질문**: 주간 뷰에서 이전 달 또는 다음 달의 날짜를 클릭하면 어떻게 동작해야 하나요?
- 옵션 A: 해당 날짜로 폼 날짜 변경 (다른 달이어도 가능)
- 옵션 B: 뷰를 해당 월로 이동한 후 날짜 변경
- 옵션 C: 클릭 차단 (현재 월의 날짜만 클릭 가능)

**답변**: 옵션 A - 해당 날짜로 폼 날짜 변경 (모든 날짜 클릭 가능)

### Q7: 터치 디바이스 지원
**질문**: 모바일/태블릿 터치 이벤트도 지원해야 하나요?
- 옵션 A: onClick만 구현 (터치는 자동 변환)
- 옵션 B: onTouchStart도 별도로 구현
- 옵션 C: 터치 지원 없음

**답변**: 옵션 A - 데스크톱 onClick만 지원 (React가 자동 변환)

### Q8: 우선순위 확인
**질문**: 다음 우선순위가 맞나요?
1. 월간 뷰 구현
2. 주간 뷰 구현
3. 주간 뷰 이전/다음 달 날짜
4. null 셀 클릭 방지
5. 편집 모드 날짜 변경
6. 기존 폼 데이터 유지
7. 이벤트 박스 stopPropagation

**답변**: 확인됨 - 우선순위 순서 적용

---

## 1. 기능 개요

캘린더의 날짜 셀(TableCell)을 클릭하면 일정 입력 폼의 날짜 필드가 자동으로 해당 날짜로 설정됩니다. 편집 모드에서도 날짜만 변경되며 기존 폼 데이터(제목, 시간, 반복 설정 등)는 모두 유지됩니다.

---

## 2. 사용자 시나리오 (우선순위 순)

### 시나리오 1: 월간 뷰 빈 날짜 클릭
**사용자**: 12월 25일 날짜 셀의 빈 공간을 클릭합니다.
**시스템**: 폼의 날짜 필드가 "2024-12-25"로 설정됩니다.
**결과**: 사용자는 제목과 시간만 입력하면 됩니다.

### 시나리오 2: 주간 뷰 날짜 클릭
**사용자**: 주간 뷰에서 수요일 날짜 셀을 클릭합니다.
**시스템**: 폼의 날짜 필드가 해당 수요일로 설정됩니다.
**결과**: 주간 뷰에서도 동일하게 동작합니다.

### 시나리오 3: 편집 모드에서 다른 날짜 클릭
**사용자**: "회의" 일정을 편집 중 다른 날짜를 클릭합니다.
**시스템**: 편집 모드 유지, 날짜만 변경, 제목/시간/반복 설정 모두 유지됩니다.
**결과**: 회의 일정의 날짜만 변경됩니다.

### 시나리오 4: 반복 일정 설정 후 날짜 변경
**사용자**: 매주 반복 설정 후 시작 날짜를 변경하기 위해 다른 날짜를 클릭합니다.
**시스템**: 반복 설정 완전히 유지, 날짜만 변경됩니다.
**결과**: 새 시작 날짜부터 매주 반복되는 일정이 생성됩니다.

### 시나리오 5: 이벤트 박스 영역 클릭
**사용자**: 날짜 셀 내의 이벤트 박스를 클릭합니다.
**시스템**: 아무 동작도 하지 않습니다 (stopPropagation).
**결과**: 드래그 앤 드롭만 가능합니다.

---

## 3. 요구사항

### 3.1 기능 요구사항

| 번호 | 요구사항 | 우선순위 |
|------|----------|----------|
| FR-1 | 월간 뷰의 날짜 셀(day !== null) 클릭 시 폼 날짜가 해당 날짜로 변경되어야 함 | P0 |
| FR-2 | 주간 뷰의 모든 날짜 셀 클릭 시 폼 날짜가 해당 날짜로 변경되어야 함 | P0 |
| FR-3 | 주간 뷰에서 이전 달/다음 달 날짜도 클릭 가능해야 함 | P1 |
| FR-4 | 월간 뷰에서 null 셀은 클릭 불가능해야 함 | P1 |
| FR-5 | 편집 모드에서 날짜 클릭 시 날짜만 변경되고 편집 모드는 유지되어야 함 | P1 |
| FR-6 | 날짜 변경 시 기존 폼 데이터(제목, 시간, 설명, 위치, 카테고리, 알림 시간)가 유지되어야 함 | P1 |
| FR-7 | 반복 설정(isRepeating, repeatType, repeatInterval, repeatEndDate)이 완전히 유지되어야 함 | P2 |
| FR-8 | 이벤트 박스 클릭 시 날짜 변경 동작이 발생하지 않아야 함 (stopPropagation) | P0 |
| FR-9 | 시간 유효성 검증 오류가 있는 상태에서도 날짜 변경이 가능해야 함 | P2 |

### 3.2 비기능 요구사항

| 번호 | 요구사항 | 측정 기준 |
|------|----------|-----------|
| NFR-1 | 클릭 반응 속도 | 100ms 이내 날짜 필드 업데이트 |
| NFR-2 | 브라우저 호환성 | Chrome, Firefox, Safari 최신 2개 버전 |
| NFR-3 | 접근성 | 키보드 네비게이션 불필요 (마우스 전용 기능) |
| NFR-4 | 코드 품질 | 기존 컴포넌트 수정, 새 컴포넌트 생성 불필요 |

---

## 4. 기술 명세

### 4.1 구현 위치

**파일**: `src/App.tsx`

**주간 뷰 TableCell**: 라인 361-430
- `data-date` 속성: 라인 363 (formatDate로 생성된 "YYYY-MM-DD" 형식)
- onClick 핸들러 추가 위치: TableCell props에 추가

**월간 뷰 TableCell**: 라인 465-552
- `data-date` 속성: 라인 467 (formatDate로 생성된 "YYYY-MM-DD" 형식 또는 undefined)
- onClick 핸들러 추가 위치: TableCell props에 추가

**이벤트 박스 (주간)**: 라인 394-427
- stopPropagation 추가 위치: Box onClick props

**이벤트 박스 (월간)**: 라인 506-548
- stopPropagation 추가 위치: Box onClick props

### 4.2 폼 상태 관리

**Hook**: `useEventForm` (`src/hooks/useEventForm.ts`)
- `setDate` 함수: 라인 78 (이미 제공됨)
- 다른 상태는 건드리지 않고 `setDate`만 호출

### 4.3 날짜 포맷

**형식**: `YYYY-MM-DD` (예: "2024-12-25")
**유틸리티**: `formatDate(currentDate, day)` from `src/utils/dateUtils.ts`
- currentDate: 현재 뷰의 Date 객체
- day: 날짜 숫자 (1-31) 또는 undefined

### 4.4 구현 상세

#### 4.4.1 주간 뷰 구현

```typescript
// src/App.tsx - 주간 뷰 TableCell
<TableCell
  key={date.toISOString()}
  data-date={dateString}
  onClick={() => {
    setDate(dateString);  // useEventForm의 setDate 호출
  }}
  onDragOver={(e) => e.preventDefault()}
  // ... 기존 props
>
  {/* 기존 내용 */}
  {filteredEvents.map((event) => (
    <Box
      key={event.id}
      onClick={(e) => e.stopPropagation()}  // 이벤트 박스는 클릭 차단
      // ... 기존 props
    >
      {/* 기존 내용 */}
    </Box>
  ))}
</TableCell>
```

#### 4.4.2 월간 뷰 구현

```typescript
// src/App.tsx - 월간 뷰 TableCell
<TableCell
  key={dayIndex}
  data-date={dateString || undefined}
  onClick={() => {
    if (dateString) {  // null 셀 클릭 방지
      setDate(dateString);
    }
  }}
  onDragOver={(e) => {
    if (dateString) e.preventDefault();
  }}
  // ... 기존 props
>
  {day && (
    <>
      {/* 기존 날짜/공휴일 표시 */}
      {getEventsForDay(filteredEvents, day).map((event) => (
        <Box
          key={event.id}
          onClick={(e) => e.stopPropagation()}  // 이벤트 박스는 클릭 차단
          // ... 기존 props
        >
          {/* 기존 내용 */}
        </Box>
      ))}
    </>
  )}
</TableCell>
```

### 4.5 동작 흐름

```
1. 사용자가 날짜 셀(TableCell) 클릭
   ↓
2. onClick 핸들러 실행
   ↓
3. dateString 존재 여부 확인 (월간 뷰의 경우)
   ↓
4. setDate(dateString) 호출
   ↓
5. useEventForm의 date 상태만 업데이트
   ↓
6. 다른 폼 데이터는 변경되지 않음
   ↓
7. 편집 모드(editingEvent)도 유지됨
```

### 4.6 이벤트 버블링 처리

```
이벤트 박스 클릭
   ↓
onClick={(e) => e.stopPropagation()}
   ↓
부모 TableCell의 onClick 실행 안됨
   ↓
날짜 변경 안됨
```

---

## 5. 엣지 케이스 처리

### 5.1 월간 뷰 null 셀 클릭

**상황**: 월의 첫 주나 마지막 주에서 이전/다음 달 영역(day === null)을 클릭
**처리**: `if (dateString)` 조건으로 클릭 차단
**이유**: `data-date`가 undefined이므로 자연스럽게 무시됨

### 5.2 주간 뷰 이전/다음 달 날짜

**상황**: 주간 뷰에서 12월 1주차 뷰에서 11월 29일을 클릭
**처리**: 정상적으로 "2024-11-29"로 날짜 변경
**이유**: `getWeekDates`가 모든 날짜에 대해 유효한 Date 객체 반환

### 5.3 편집 모드 + 시간 오류 상태

**상황**: 일정 편집 중 시간 오류(endTime < startTime)가 있는 상태에서 날짜 클릭
**처리**:
- 날짜만 변경됨
- `editingEvent` 상태 유지
- `startTimeError`, `endTimeError` 상태 유지
- 사용자는 날짜 변경 후에도 시간 오류를 수정해야 함

**이유**: `setDate`는 `timeError` 상태와 독립적

### 5.4 반복 일정 설정 유지

**상황**: 매주 반복 설정 후 시작 날짜 변경
**처리**:
- `isRepeating: true` 유지
- `repeatType: 'weekly'` 유지
- `repeatInterval: 1` 유지
- `repeatEndDate` 유지
- `date`만 "2024-12-25" → "2024-12-30"으로 변경

**결과**: 저장 시 새 시작 날짜부터 반복 일정 생성

### 5.5 드래그 중 클릭

**상황**: 이벤트를 드래그 중 다른 날짜 셀을 클릭
**처리**:
- 드래그는 `onDrop` 핸들러로 처리
- 클릭은 `onClick` 핸들러로 처리
- 두 이벤트는 독립적으로 동작

**이유**: 드래그 시작 후 클릭 이벤트는 발생하지 않음 (브라우저 기본 동작)

### 5.6 빠른 연속 클릭

**상황**: 여러 날짜를 빠르게 연속으로 클릭
**처리**: 각 클릭마다 `setDate` 호출, 마지막 클릭의 날짜가 최종 적용
**이유**: React setState는 동기적으로 처리되지 않지만 순서는 보장됨

---

## 6. 테스트 기준

### 6.1 단위 테스트 (Unit Tests)

| 테스트 ID | 설명 | 입력 | 예상 출력 | 우선순위 |
|-----------|------|------|-----------|----------|
| UT-1 | 월간 뷰 날짜 클릭 시 setDate 호출 | day=25 클릭 | setDate("2024-12-25") | P0 |
| UT-2 | 주간 뷰 날짜 클릭 시 setDate 호출 | 수요일 클릭 | setDate("2024-12-20") | P0 |
| UT-3 | null 셀 클릭 시 아무 동작 안함 | day=null 클릭 | setDate 미호출 | P1 |
| UT-4 | 이벤트 박스 클릭 시 stopPropagation | 이벤트 박스 클릭 | setDate 미호출 | P0 |

### 6.2 통합 테스트 (Integration Tests)

| 테스트 ID | 설명 | 사용자 동작 | 시스템 동작 | 검증 기준 | 우선순위 |
|-----------|------|-------------|-------------|-----------|----------|
| IT-1 | 월간 뷰 날짜 클릭 → 폼 날짜 변경 | 12/25 클릭 | 날짜 필드 "2024-12-25" | input[type="date"].value === "2024-12-25" | P0 |
| IT-2 | 주간 뷰 날짜 클릭 → 폼 날짜 변경 | 수요일 클릭 | 날짜 필드 변경 | input[type="date"].value === 해당 날짜 | P0 |
| IT-3 | 편집 모드 + 날짜 클릭 → 날짜만 변경 | 편집 중 다른 날짜 클릭 | 날짜만 변경, 제목 유지 | title 유지, date 변경 | P1 |
| IT-4 | 반복 설정 + 날짜 클릭 → 설정 유지 | 반복 설정 후 날짜 클릭 | 반복 설정 유지 | repeatType, interval 유지 | P2 |
| IT-5 | 시간 오류 + 날짜 클릭 → 오류 유지 | 오류 상태에서 날짜 클릭 | 날짜만 변경 | 오류 메시지 유지 | P2 |
| IT-6 | 이벤트 박스 클릭 → 날짜 불변 | 이벤트 박스 클릭 | 아무 변화 없음 | date 불변 | P1 |

### 6.3 E2E 테스트 (End-to-End Tests)

| 테스트 ID | 시나리오 | 검증 기준 | 우선순위 |
|-----------|----------|-----------|----------|
| E2E-1 | 날짜 클릭 → 일정 생성 → 저장 | 클릭한 날짜에 일정 표시됨 | P0 |
| E2E-2 | 편집 중 날짜 클릭 → 일정 수정 → 저장 | 새 날짜에 일정 이동됨 | P1 |
| E2E-3 | 반복 설정 + 날짜 클릭 → 저장 | 새 날짜부터 반복 일정 생성 | P2 |

### 6.4 회귀 테스트 (Regression Tests)

| 테스트 ID | 기존 기능 | 검증 기준 | 우선순위 |
|-----------|-----------|-----------|----------|
| RT-1 | 드래그 앤 드롭 | 날짜 클릭이 드래그를 방해하지 않음 | P0 |
| RT-2 | 폼 초기화 | 날짜 클릭이 resetForm을 호출하지 않음 | P1 |
| RT-3 | 공휴일 표시 | 날짜 클릭이 공휴일 표시를 방해하지 않음 | P2 |

---

## 7. 제약사항 및 향후 개선

### 7.1 현재 제약사항

1. **키보드 네비게이션 미지원**: 마우스 클릭만 가능, 키보드 접근성 없음
2. **터치 최적화 없음**: 모바일에서 onClick에 의존, 별도 터치 핸들러 없음
3. **더블 클릭 방지 없음**: 빠른 연속 클릭 시 다중 setState 호출 가능
4. **시각적 피드백 없음**: 클릭한 날짜 셀에 대한 하이라이트 없음
5. **Undo/Redo 없음**: 날짜 변경을 되돌릴 수 없음

### 7.2 향후 개선 사항

#### 우선순위 1 (필수)
- 날짜 클릭 시 시각적 피드백 (셀 하이라이트 0.2초)
- 더블 클릭 방지 (debounce 100ms)

#### 우선순위 2 (권장)
- 키보드 네비게이션 (화살표 키로 날짜 이동, Enter로 선택)
- 접근성 개선 (aria-label, role 속성 추가)

#### 우선순위 3 (선택)
- 터치 제스처 최적화 (onTouchStart, onTouchEnd)
- Undo/Redo 기능 (날짜 변경 히스토리)

### 7.3 호환성 참고사항

- **React 18**: 현재 코드베이스와 호환
- **Material-UI v5**: TableCell onClick은 기본 지원
- **TypeScript**: onClick 타입은 `MouseEvent<HTMLTableCellElement>`
- **드래그 앤 드롭**: onClick과 onDrop은 독립적으로 동작

---

## 8. 구현 체크리스트

### Phase 1: 핵심 기능 (P0)
- [ ] 주간 뷰 TableCell에 onClick 핸들러 추가
- [ ] 월간 뷰 TableCell에 onClick 핸들러 추가 (null 체크 포함)
- [ ] 주간 뷰 이벤트 박스에 stopPropagation 추가
- [ ] 월간 뷰 이벤트 박스에 stopPropagation 추가

### Phase 2: 통합 테스트 (P1)
- [ ] 월간 뷰 날짜 클릭 테스트 작성
- [ ] 주간 뷰 날짜 클릭 테스트 작성
- [ ] 편집 모드 날짜 변경 테스트 작성
- [ ] 이벤트 박스 stopPropagation 테스트 작성

### Phase 3: 엣지 케이스 (P2)
- [ ] null 셀 클릭 방지 테스트
- [ ] 반복 설정 유지 테스트
- [ ] 시간 오류 유지 테스트
- [ ] 주간 뷰 이전/다음 달 클릭 테스트

### Phase 4: 회귀 테스트 (P2)
- [ ] 드래그 앤 드롭 정상 동작 확인
- [ ] 폼 초기화 비영향 확인
- [ ] 공휴일 표시 비영향 확인

---

## 9. 참고 자료

### 9.1 관련 파일
- `src/App.tsx`: 주간/월간 뷰 TableCell 컴포넌트 (라인 358-556)
- `src/hooks/useEventForm.ts`: setDate 함수 제공 (라인 78)
- `src/utils/dateUtils.ts`: formatDate 유틸리티 (라인 104-110)

### 9.2 관련 명세서
- `specs/drag-and-drop-feature.md`: 드래그 앤 드롭 기능 (이벤트 박스 stopPropagation 참고)

### 9.3 데이터 구조
```typescript
// data-date 속성
dateString: string = "YYYY-MM-DD" | ""

// useEventForm
setDate: (date: string) => void
```

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2025-11-04 | 초안 작성 - Q&A 기반 명세서 | spec-writer |
