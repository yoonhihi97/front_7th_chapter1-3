# 드래그 앤 드롭 기능 명세서

## 개요
캘린더의 일정을 마우스로 끌어 다른 날짜로 옮기는 드래그 앤 드롭(D&D) 기능을 구현합니다.

## 요구사항 출처
사용자 승인 완료 (2025-11-02)

## 핵심 기능

### 1. 드래그 범위
- **주간 뷰**: 지원
- **월간 뷰**: 지원
- 두 뷰 모두에서 동일하게 작동

### 2. 드래그 동작
- **변경 사항**: 날짜(date)만 변경
- **유지 사항**: 시간(startTime, endTime) 기존 값 유지
- **예시**: 2025-01-01 10:00-11:00 일정을 2025-01-05로 드래그 → 2025-01-05 10:00-11:00

### 3. 드래그 소스 (Draggable)
- **대상**: 캘린더 그리드의 일정 박스만
- **UI 위치**:
  - 주간 뷰: `TableCell` 내부의 `Box` (event box)
  - 월간 뷰: `TableCell` 내부의 `Box` (event box)
- **제외**: 일정 목록(event-list)의 일정 카드는 드래그 불가

### 4. 드롭 대상 (Drop Target)
- **대상**: 캘린더 그리드의 날짜 셀만
- **UI 위치**:
  - 주간 뷰: `TableCell` (날짜별)
  - 월간 뷰: `TableCell` (날짜별)
- **제외**: 빈 셀(day가 null인 경우)은 드롭 불가

### 5. 시각적 피드백
- **드래그 중**: 커서만 변경 (`cursor: move` → `cursor: grabbing`)
- **드롭 가능 영역**: 시각적 강조 없음 (YAGNI 원칙)
- **드래그 ghost 이미지**: 브라우저 기본값 사용

### 6. 반복 일정 처리
- **드롭 완료 후**: 기존 `RecurringEventDialog` 표시
- **사용자 선택**:
  - "예" → 해당 일정만 날짜 변경 (단일 편집)
  - "아니오" → 반복 시리즈 전체 날짜 변경 (전체 편집)
- **다이얼로그 모드**: `mode="edit"`
- **기존 컴포넌트 재사용**: `RecurringEventDialog.tsx`

### 7. 겹침 검증
- **드롭 즉시**: `findOverlappingEvents` 함수로 검증
- **겹침 발생 시**: 기존 Overlap Dialog 표시
- **사용자 선택**:
  - "취소" → 드래그 취소, 원래 날짜 유지
  - "계속 진행" → 날짜 변경 저장
- **기존 로직 재사용**: App.tsx의 Overlap Dialog

### 8. 드래그 제한
- **제한 없음**: 모든 일정 드래그 가능
- **과거 일정**: 드래그 가능
- **미래 일정**: 드래그 가능
- **반복 일정**: 드래그 가능

### 9. 터치 지원
- **데스크톱만**: HTML5 Drag and Drop API 사용
- **모바일**: 지원 안 함 (향후 확장 가능)

## 기술적 구현 세부사항

### HTML5 Drag and Drop API 이벤트

**드래그 소스 (Draggable Element)**:
- `onDragStart`: 드래그 시작 시 이벤트 ID 저장 (`dataTransfer.setData`)
- `onDragEnd`: 드래그 종료 시 상태 초기화

**드롭 대상 (Drop Target)**:
- `onDragOver`: 드롭 허용 (`e.preventDefault()`)
- `onDrop`: 드롭 처리 (이벤트 ID 읽기, 날짜 변경 로직 실행)

### 상태 관리
- 드래그 중인 이벤트 ID: 로컬 상태로 관리
- 기존 이벤트 상태: `useEventOperations`의 `events` 배열 활용

### API 호출
- **날짜 변경**: `useEventOperations.saveEvent` 재사용
- **반복 일정**: `useRecurringEventOperations.handleRecurringEdit` 재사용

### 날짜 계산
- **드롭된 셀의 날짜**: `TableCell`에 `data-date` 속성 추가
- **새 이벤트 객체**: `{ ...event, date: newDate }`

## 사용자 플로우

### 일반 일정 드래그
1. 사용자가 일정 박스를 드래그 시작
2. 커서가 `grabbing`으로 변경
3. 사용자가 다른 날짜 셀로 드래그
4. 드롭 시 겹침 검증
5. 겹침 없으면 → 즉시 저장, 성공 토스트
6. 겹침 있으면 → Overlap Dialog → 사용자 선택 → 저장/취소

### 반복 일정 드래그
1. 사용자가 반복 일정 박스를 드래그 시작
2. 커서가 `grabbing`으로 변경
3. 사용자가 다른 날짜 셀로 드래그
4. 드롭 시 `RecurringEventDialog` 표시
5. 사용자가 "예/아니오" 선택
6. 겹침 검증
7. 겹침 없으면 → 즉시 저장
8. 겹침 있으면 → Overlap Dialog → 저장/취소

## 비기능적 요구사항

### 기존 테스트 보존
- 모든 기존 테스트는 깨지지 않아야 함
- 새 기능은 기존 로직에 영향을 주지 않음

### 접근성
- 드래그 앤 드롭은 마우스만 지원
- 키보드 사용자를 위한 대체 방법: 기존 편집 버튼 사용

### 성능
- 드래그 이벤트 핸들러는 가볍게 유지
- 불필요한 리렌더링 방지

## 제외 사항 (YAGNI)

다음 기능은 구현하지 않습니다:
- 드래그 중 시각적 강조 효과
- 커스텀 ghost 이미지
- 모바일 터치 지원
- 드래그 취소 버튼 (ESC 키)
- 드래그 제한 (과거/미래 날짜)
- 애니메이션 효과
- 드래그 중 미리보기
- 다중 선택 드래그

## 테스트 전략

### Unit Tests
- 드래그 핸들러 함수 (handleDragStart, handleDrop)
- 날짜 변경 로직
- 겹침 검증 (기존 함수 재사용)

### Integration Tests
- 일반 일정 드래그 앤 드롭 전체 플로우
- 반복 일정 드래그 시 RecurringEventDialog 표시
- 겹침 발생 시 Overlap Dialog 표시
- 주간/월간 뷰 전환 후 드래그

### E2E Tests (Playwright)
- 실제 브라우저에서 드래그 앤 드롭 동작
- 반복 일정 드래그 시나리오
- 겹침 경고 시나리오

### Storybook Stories
- 드래그 가능한 일정이 있는 주간 뷰
- 드래그 가능한 일정이 있는 월간 뷰
- 반복 일정 드래그 상태

## 구현 우선순위

### P0 (필수)
- HTML5 Drag and Drop API 적용
- 날짜만 변경 로직
- 겹침 검증 통합
- 반복 일정 RecurringEventDialog 통합

### P1 (중요)
- 주간 뷰 지원
- 월간 뷰 지원

### P2 (선택)
- E2E 테스트
- Storybook 스토리

## 기대 효과

### 사용성 개선
- 일정 편집이 더 직관적
- 클릭 횟수 감소 (편집 버튼 → 폼 입력 → 저장 대신 드래그만)

### 사용자 경험
- 캘린더 앱의 표준 기능 제공
- 데스크톱 사용자 편의성 증가

## 제약사항

### 브라우저 호환성
- HTML5 Drag and Drop API 지원 브라우저만 (Chrome, Firefox, Safari, Edge)
- IE는 미지원

### 디바이스
- 데스크톱만 지원
- 모바일/태블릿은 기존 편집 버튼 사용

## 승인 정보
- **작성일**: 2025-11-02
- **승인자**: 사용자
- **승인일**: 2025-11-02
